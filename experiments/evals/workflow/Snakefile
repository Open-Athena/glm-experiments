configfile: "config/config.yaml"


def get_all_datasets():
    """Get list of all dataset names for wildcard constraints."""
    datasets = []
    for dataset in config["dataset_configs"].keys():
        if dataset == "sat_mut_mpra_promoter":
            # Expand for each promoter
            for promoter in config["sat_mut_mpra_promoter"]:
                datasets.append(f"sat_mut_mpra_promoter_{promoter}")
        else:
            datasets.append(dataset)
    return datasets


def get_all_metric_files():
    """Generate list of all metric files based on dataset_configs."""
    files = []

    for dataset, cfg in config["dataset_configs"].items():
        # Handle sat_mut_mpra_promoter specially - expand for each promoter
        if dataset == "sat_mut_mpra_promoter":
            for promoter in config["sat_mut_mpra_promoter"]:
                dataset_name = f"sat_mut_mpra_promoter_{promoter}"
                for metric in cfg["metrics"]:
                    for model in config["models"].keys():
                        for scoring in cfg["scorings"]:
                            files.append(
                                f"results/metrics/{dataset_name}/{metric}/{model}_{scoring}.tsv"
                            )
        else:
            # Regular datasets
            for metric in cfg["metrics"]:
                for model in config["models"].keys():
                    for scoring in cfg["scorings"]:
                        files.append(
                            f"results/metrics/{dataset}/{metric}/{model}_{scoring}.tsv"
                        )

    return files


include: "rules/common.smk"
include: "rules/gnomad.smk"
include: "rules/metrics.smk"
include: "rules/model.smk"
include: "rules/sat_mut_mpra.smk"
include: "rules/traitgym.smk"


rule all:
    input:
        get_all_metric_files()
